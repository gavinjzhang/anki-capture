name = "anki-capture-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

[vars]
# MODAL_WEBHOOK_SECRET should be set via `wrangler secret put MODAL_WEBHOOK_SECRET`
# FILE_URL_SIGNING_SECRET should be set via `wrangler secret put FILE_URL_SIGNING_SECRET`
CLERK_JWT_ISSUER = "https://thankful-vulture-59.clerk.accounts.dev"
MODAL_ENDPOINT = "https://gavinjzhang--anki-capture-trigger.modal.run"
ALLOWED_ORIGINS = ""  # Set to your frontend URL, e.g., "https://anki-capture.pages.dev"

[[d1_databases]]
binding = "DB"
database_name = "anki-capture"
database_id = "36d8f48b-cbee-478f-831e-5828aaff9e28"

[[r2_buckets]]
binding = "BUCKET"
bucket_name = "anki-capture-files"
preview_bucket_name = "anki-capture-files-dev"

# For local development
[env.dev]
vars = { ENVIRONMENT = "development" }

[env.dev.d1_databases]
binding = "DB"
database_name = "anki-capture-dev"
database_id = "local"

# Production
[env.production]
vars = { ENVIRONMENT = "production", CLERK_JWT_ISSUER = "", MODAL_ENDPOINT = "https://gavinjzhang--anki-capture-trigger.modal.run", ALLOWED_ORIGINS = "*" }  # Set to your production frontend URL

[[env.production.d1_databases]]
binding = "DB"
database_name = "anki-capture"
database_id = "36d8f48b-cbee-478f-831e-5828aaff9e28"

[[env.production.r2_buckets]]
binding = "BUCKET"
bucket_name = "anki-capture-files"

[triggers]
crons = ["*/15 * * * *"]
